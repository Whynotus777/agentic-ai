# control_plane/router_policy.yaml
version: "1.0"
policies:
  - name: "robotics_safety_policy"
    priority: 100
    match:
      operation: ["actuate", "robot_control"]
      tags:
        - robotics
        - physical_automation
    guardrails:
      rate_limit_hz: 10  # Maximum 10 operations per second
      require_hitl: true
      require_approval_count: 1
      max_retry_attempts: 3
      timeout_seconds: 30
      safety_checks:
        - emergency_stop_available
        - collision_detection_enabled
        - operator_present
    fallbacks:
      - simulation_mode
      - manual_override
    policy_mode: enforce
    
  - name: "high_risk_operations"
    priority: 90
    match:
      operation: ["commit", "deploy", "delete"]
      environment: ["production", "staging"]
    guardrails:
      rate_limit_hz: 5
      require_hitl: true
      require_approval_count: 2
      approval_timeout_minutes: 30
      audit_log: true
    fallbacks:
      - dry_run
      - rollback_available
    policy_mode: enforce
    
  - name: "data_processing"
    priority: 50
    match:
      operation: ["analyze", "transform"]
      data_size_gb:
        min: 0
        max: 100
    guardrails:
      rate_limit_hz: 100
      require_hitl: false
      max_parallel_executions: 10
      memory_limit_gb: 32
    fallbacks:
      - sampling_mode
      - incremental_processing
    policy_mode: monitor
    
  - name: "development_bypass"
    priority: 10
    match:
      environment: ["development", "test"]
      user_role: ["developer", "tester"]
    guardrails:
      rate_limit_hz: 1000
      require_hitl: false
    fallbacks: []
    policy_mode: bypass

guardrail_definitions:
  rate_limit_hz:
    description: "Maximum operations per second"
    type: integer
    min: 1
    max: 10000
    default: 100
    
  require_hitl:
    description: "Require human-in-the-loop approval"
    type: boolean
    default: false
    
  require_approval_count:
    description: "Number of approvals required"
    type: integer
    min: 1
    max: 5
    default: 1
    
  timeout_seconds:
    description: "Operation timeout in seconds"
    type: integer
    min: 1
    max: 3600
    default: 300
    
  safety_checks:
    description: "Required safety checks before operation"
    type: array
    items:
      type: string
      enum:
        - emergency_stop_available
        - collision_detection_enabled
        - operator_present
        - backup_system_online
        - monitoring_active

fallback_strategies:
  simulation_mode:
    description: "Run in simulation without physical effects"
    type: action
    implementation: "redirect_to_simulator"
    
  manual_override:
    description: "Switch to manual control"
    type: action
    implementation: "notify_operator"
    
  dry_run:
    description: "Execute without committing changes"
    type: action
    implementation: "execute_readonly"
    
  rollback_available:
    description: "Ensure rollback mechanism is ready"
    type: check
    implementation: "verify_rollback_capability"
    
  sampling_mode:
    description: "Process subset of data"
    type: action
    implementation: "enable_sampling"
    
  incremental_processing:
    description: "Process in smaller chunks"
    type: action
    implementation: "enable_chunking"

policy_modes:
  enforce:
    description: "Strictly enforce all guardrails"
    block_on_violation: true
    log_violations: true
    
  monitor:
    description: "Log violations but allow execution"
    block_on_violation: false
    log_violations: true
    alert_on_violation: true
    
  bypass:
    description: "Skip policy checks (requires privileges)"
    block_on_violation: false
    log_violations: false
    require_privilege: "policy_bypass"

metadata:
  schema_version: "1.0.0"
  last_updated: "2024-01-15T00:00:00Z"
  author: "system"
  description: "Router policies with robotics rate limiting"